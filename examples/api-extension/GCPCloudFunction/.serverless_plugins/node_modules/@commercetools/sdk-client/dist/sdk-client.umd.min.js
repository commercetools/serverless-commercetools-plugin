!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("querystring")):"function"==typeof define&&define.amd?define(["exports","querystring"],t):t((e=e||self).CommercetoolsSdkClient={},e.qs)}(this,function(e,O){"use strict";function t(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,o)}return r}function v(n){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?t(Object(i),!0).forEach(function(e){var t,r,o;t=n,o=i[r=e],r in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(i,e))})}return n}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],o=!0,n=!1,i=void 0;try{for(var c,s=e[Symbol.iterator]();!(o=(c=s.next()).done)&&(r.push(c.value),!t||r.length!==t);o=!0);}catch(e){n=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(n)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function i(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}O=O&&Object.prototype.hasOwnProperty.call(O,"default")?O.default:O;var c=["ACL","BIND","CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LINK","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCALENDAR","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REBIND","REPORT","SEARCH","SOURCE","SUBSCRIBE","TRACE","UNBIND","UNLINK","UNLOCK","UNSUBSCRIBE"];function s(e,t,r){var o=2<arguments.length&&void 0!==r?r:{allowedMethods:c};if(!t)throw new Error('The "'.concat(e,'" function requires a "Request" object as an argument. See https://commercetools.github.io/nodejs/sdk/Glossary.html#clientrequest'));if("string"!=typeof t.uri)throw new Error('The "'.concat(e,'" Request object requires a valid uri. See https://commercetools.github.io/nodejs/sdk/Glossary.html#clientrequest'));if(!o.allowedMethods.includes(t.method))throw new Error('The "'.concat(e,'" Request object requires a valid method. See https://commercetools.github.io/nodejs/sdk/Glossary.html#clientrequest'))}e.createClient=function(o){if(!o)throw new Error("Missing required options");if(o.middlewares&&!Array.isArray(o.middlewares))throw new Error("Middlewares should be an array");if(!o.middlewares||!Array.isArray(o.middlewares)||!o.middlewares.length)throw new Error("You need to provide at least one middleware");return{execute:function(r){return s("exec",r),new Promise(function(e,t){(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return 1===(t=t.filter(function(e){return"function"==typeof e})).length?t[0]:t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})}).apply(void 0,i(o.middlewares))(function(e,t){if(t.error)t.reject(t.error);else{var r={body:t.body||{},statusCode:t.statusCode};t.headers&&(r.headers=t.headers),t.request&&(r.request=t.request),t.resolve(r)}})(r,{resolve:e,reject:t,body:void 0,error:void 0})})},process:function(y,m,e){var b=this;if(s("process",y,{allowedMethods:["GET"]}),"function"!=typeof m)throw new Error('The "process" function accepts a "Function" as a second argument that returns a Promise. See https://commercetools.github.io/nodejs/sdk/api/sdkClient.html#processrequest-processfn-options');var w=v({total:Number.POSITIVE_INFINITY,accumulate:!0},e);return new Promise(function(u,l){var e=n(y.uri.split("?"),2),d=e[0],t=e[1],r=v({},O.parse(t)),f=v({limit:20},r),h=!1,p=w.total;!function c(e,t){var s=1<arguments.length&&void 0!==t?t:[],r=f.limit<p?f.limit:p,o=O.stringify(v({},f,{limit:r})),n=v({sort:"id asc",withTotal:!1},e?{where:'id > "'.concat(e,'"')}:{}),i=O.stringify(n),a=v({},y,{uri:"".concat(d,"?").concat(i,"&").concat(o)});b.execute(a).then(function(e){var t=e.body,n=t.results,i=t.count;i||!h?Promise.resolve(m(e)).then(function(e){var t;if(h=!0,w.accumulate&&(t=s.concat(e||[])),p-=i,i<f.limit||!p)u(t||[]);else{var r=n[i-1],o=r&&r.id;c(o,t)}}).catch(l):u(s||[])}).catch(l)}()})}}},Object.defineProperty(e,"__esModule",{value:!0})});
